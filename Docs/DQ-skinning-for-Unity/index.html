<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Dual quaternion skinner: Dual quaternion skinning for Unity</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Dual quaternion skinner
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Dual quaternion skinning for Unity </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h3>Features:</h3>
<ul>
<li>GPU skinning with compute shaders (only)</li>
<li>blend shape support (calculations performed in compute shader)</li>
<li>works with any platform that supports compute shaders</li>
<li>preserves volume with deformation (look comparison)</li>
<li>zero GC allocations per frame</li>
<li>original bulging compensation method</li>
</ul>
<h3>Comparison to default linear skinning:</h3>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Gif  </th><th class="markdownTableHeadNone">Difference   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><img src="https://raw.githubusercontent.com/ConstantineRudenko/DQ-skinning-for-Unity/master/Screenshots/before-after.gif" width="400" alt="" class="inline"/>
  </td><td class="markdownTableBodyNone"><img src="https://raw.githubusercontent.com/ConstantineRudenko/DQ-skinning-for-Unity/master/Screenshots/diff.png" width="400" alt="" class="inline"/>
   </td></tr>
</table>
<h1>Warning:</h1>
<p>You will not see any effect in edit mode.<br />
 The scipt only works in play mode.<br />
 If you see no effect in play mode verify that you are using the right shader.</p>
<h2>Unity version</h2>
<p>The script was tested with following Unity versions:</p><ul>
<li><b>2019.2.9f1</b></li>
</ul>
<h2>Performance:</h2>
<p>During my testing the amount of time spent on actual skinning was negligible compared to the amount of time extracting <code>localToWorldMatrix</code> from every bone in the hierarchy.</p>
<p>As long as you are not creating hundreds of characters with complex rigs (no matter the polycount) there should be no significant performance hit.</p>
<p>If anyone knows how to optimize extracting <code>localToWorldMatrix</code> of the bones please create an <a href="https://github.com/ConstantineRudenko/DQ-skinning-for-Unity/issues">issue</a> or message me on <a href="https://forum.unity.com/threads/dual-quaternion-skinning-for-unity.501245/">unity forum</a>.</p>
<p><b>did not benchmark bulging compensation yet</b></p>
<h2>How to set up:</h2>
<ul>
<li>Create a skinned character with <code>SkinnedMeshRenderer</code> component</li>
<li>Add <code><a class="el" href="_dual_quaternion_skinner_8cs_source.html">DualQuaternionSkinner.cs</a></code> component (it will require a <code>MeshFilter</code> component)</li>
<li>Enable mesh Read/Write in import settings<br />
</li>
</ul>
<img src="https://raw.githubusercontent.com/ConstantineRudenko/DQ-skinning-for-Unity/master/Screenshots/Mesh import settings.png" width="463" alt="" class="inline"/>
<ul>
<li>All materials of the mesh should use a special shader to apply vertex positions. The shader is <code>MadCake/Material/Standard hacked for DQ skinning</code></li>
<li>In order for bulging compensation to work properly, all the character's bones must have one local axis (consistent for all bones) aligned with the limb controlled by the corresponding bone.</li>
</ul>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Bones properly aligned  </th><th class="markdownTableHeadNone">Bones not aligned   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><img src="https://raw.githubusercontent.com/ConstantineRudenko/DQ-skinning-for-Unity/master/Screenshots/bones aligned.png" width="400" alt="" class="inline"/>
  </td><td class="markdownTableBodyNone"><img src="https://raw.githubusercontent.com/ConstantineRudenko/DQ-skinning-for-Unity/master/Screenshots/bones not aligned.png" width="400" alt="" class="inline"/>
   </td></tr>
</table>
<ul>
<li>Whichever local axis of the bones was aligned with the limbs must be selected in the script gui:</li>
</ul>
<img src="https://raw.githubusercontent.com/ConstantineRudenko/DQ-skinning-for-Unity/master/Screenshots/Orientation axis.png" width="363" alt="" class="inline"/>
<p>If bulging is increased instead of decreased, select same axis with different direction (<b>X</b>&#160;=&gt;&#160;<b>Negative&#160;X</b>)</p>
<h2>Common problems</h2>
<p>The script is programmed to automatically detect common setup problems. Check out the editor:</p>
<img src="https://raw.githubusercontent.com/ConstantineRudenko/DQ-skinning-for-Unity/master/Screenshots/Problems.png" width="363" alt="" class="inline"/>
<h2>Why do i need SkinnedMeshRenderer?</h2>
<p>My scripts uses <code>SkinnedMeshRenderer</code> to extract an array of bones from it. Yep, that's it.<br />
 The order of bones is unpredictable and does not depend on their hierarchy.<br />
 Only SkinnedMeshRenderer knows it &#160;&#160; ¯\_(ツ)_/¯</p>
<p>After extracting the bone array in <code>Start()</code> my script disables <code>SkinnedMeshRenderer</code> component as it is no longer needed. All the animations are performed by the script. You can verify it in the editor after hitting play button.</p>
<h2>How do I use custom shaders?</h2>
<p>Alas it's complicated.<br />
 I added comments to "Standard hacked for DQ skinning" marking the alterations i made to the Standard shader.<br />
 You can try to do the same with your own shader to make it work with the script.</p>
<p>Feel free to contact me in <a href="https://forum.unity.com/threads/dual-quaternion-skinning-for-unity.501245/">this thread</a> at unity forum if you need help.</p>
<p>I would also like to hear about your projects that use my script and your experience with it.</p>
<h2>API</h2>
<p><a href="https://constantinerudenko.github.io/Docs/DQ-skinning-for-Unity/index.html">Documentation</a></p>
<h2>Future plans</h2>
<ul>
<li>Test/improve/optimize bulging compensation</li>
<li>Implement toggle for bulging compensation</li>
<li>Implement simple runtime switching between <b>DualQuaternionSkinned</b> and built-in <a href="https://docs.unity3d.com/Manual/class-SkinnedMeshRenderer.html">SkinnedMeshRenderer</a></li>
<li>It might make sense to group the data from all instances of the script into one batch and run the compute shaders only once per frame regardless of how many animated characters you have</li>
</ul>
<h2>Discussion</h2>
<p>If you have any questions, ideas, bug reports, or just want to discuss the script, you can contact me on <a href="https://forum.unity.com/threads/dual-quaternion-skinning-for-unity.501245/">unity forum</a> </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.15
</small></address>
</body>
</html>
